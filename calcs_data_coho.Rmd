---
title: "Coho Calculations"
editor_options: 
  chunk_output_type: console
---

```{r, include=FALSE, results = 'hide', warning = FALSE, message = FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, fig.height=9, fig.width=9)
```

# 1. Model Structure

## 1.1. Stocks

Currently, 123 stock groups are represented in Coho <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span>. Each of these stock groups have both marked (adipose fin clipped) and unmarked components to permit assessment of mark-selective fishery regulations; therefore, the current version of <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> has a total of 246 stock units (**Appendix 1**).  Model stocks may represent an individual salmon stock or an aggregate of stocks from the same region.  Stock units represented in <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> were chosen based on the level of management interest, their contribution to <span title = "PFMC: Pacific Fishery Management Council">PFMC</span> fisheries, and the availability of representative coded-wire tag (<a href = "https://framverse.github.io/fram_doc/calcs_glossary.html#Coded-Wire_Tag_(CWT)" target = "_blank" title = "CWT: Coded-wire tag">CWT</a>) recoveries in the Regional Mark Information System (<a title = "RMIS" href = "https://www.rmpc.org/" target = "_blank">RMIS</a>).  Coho <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> includes a comprehensive set of stocks originating from Central California to Southeast Alaska and is considered to represent total West Coast production. For coho, only age three fish are included in the model.

## 1.2. Fisheries

The <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> includes pre-terminal and terminal fisheries in southeast Alaska, Canada, Puget Sound, and off the coasts of Washington, Oregon, and California.  There are 198 fisheries in Coho <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> A unique fishery identification number and fishery name for each of the <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> fisheries are listed in **Appendix 3**. Terminal fisheries in Coho <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> include individual freshwater fisheries. <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> can model directed fisheries, mark-selective fisheries, and non-retention fisheries, and also calculates fisheries-related incidental mortalities. 

## 1.3. Time Steps

The time step structure used in <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> represents a level of resolution that corresponds to data availability, fishery management structure, and species-specific migration and maturation schedules. Recoveries of <span title = "CWT: Coded wire tag">CWTs</span> for each stock unit during years with widespread tagging and fisheries (the reference <a href = "https://framverse.github.io/fram_doc/calcs_glossary.html#Base_Period" target = "_blank" title = "Base period">base period</a>, explained further in **Section 3**) are used to estimate model parameters such as exploitation rates. The amount of recovery data available by stock unit and fishery in the historical <span title = "CWT: Coded wire tag">CWT</span> database limit the time-step resolution of the model.  Decreasing the number of <span title = "CWT: Coded wire tag">CWT</span> recoveries in a time step by making the time step shorter can increase the variance of the estimated parameters in those strata.  In recognition of these data limitations, efforts were made to restrict the level of time step resolution to that necessary for fishery management purposes.

At each time step, a stock experiences natural mortality, and can be subjected to pre-terminal fisheries, and terminal fisheries. 

<span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> contains five time periods for coho, covering a single calendar year (**Appendix Table 5**).  

Table 1. Time step structure used in Coho FRAM.
```{r calcs_data_coho_t1_timesteps, echo=FALSE}
dplyr::tibble(
  `Time Step` = c(1:5),
  Months = c("January - June", "July", "August", "September", "October - December")
  ) |> gt::gt()
```

<br>

# 2. Assumptions and Limitations

*Major assumptions and limitations of the model are briefly described below.*

**<span title = "CWT: Coded wire tag">CWT</span> fish accurately represent the modeled stock.**  Many <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> stocks are aggregates of stocks that are represented by <span title = "CWT: Coded wire tag">CWTs</span> from only one production type, usually hatchery origin.  For example, in nearly all cases wild/natural stocks are aggregated with hatchery stocks and both are represented by the hatchery stock’s <span title = "CWT: Coded wire tag">CWT</span> data.  Therefore, for each modeled stock aggregate, it is assumed that the tagged and untagged fish are distributed and exploited at the same rates.

**Each stock unit and age class is exploited as a single pool.** All pre-terminal fisheries operate on the entire cohort simultaneously in each time step, and all terminal fisheries operate on the mature run.

**Natural mortality is constant from year to year.** Natural mortality is assumed to be constant across months for all stocks.  

**Stock distribution and migration is constant from year to year and is represented by the average distribution of <span title = "CWT: Coded wire tag">CWT</span> recoveries during the reference base period.**  We currently lack data on the annual variability in distribution and migration patterns of Chinook and coho salmon stocks.  In the absence of such estimates, fishery-specific exploitation rates are computed relative to the entire cohort.

# 3. Model Parameterization

<span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> data are stored as tables in an ACCESS database. All the information needed for a “simple model run” (link to chapter in user manual) is stored in these tables, containing input as well as output data. Input data can be grouped into two main categories: static base period data and annual run data (see **section 3.1**). Main <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> outputs are mortalities (landed, mark-selective, sublegal, non-retention, drop-off) and abundances (starting cohorts at each time step; abundances after natural mortalities, pre-terminal, and terminal fisheries).

Table 2. Coho <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> MS Accesss Database Tables.
```{r coho database tables, echo=FALSE}
knitr::include_graphics(c("images/Coho_FRAM_database_tables.PNG"))
```

## 3.1. <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> Input Data

<span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> input data consist of two main input types: base period reference data and annual data.  Base period data remain constant until a new base period replaces the existing one.  The principal base period inputs are stock-fishery specific exploitation rates.  Other base period parameters include base period catches and cohort sizes.  The second input type consists of annual data that can vary with each model run, such as stock specific abundance estimates, fishery catches, size limits, etc.  

### 3.1.1. Base Period Data

<span title = "CWT: Coded wire tag">CWT</span> recoveries are used to estimate model parameters such as time/area/fishery exploitation rates and maturation rates for modeled stocks.  The years from which <span title = "CWT: Coded wire tag">CWT</span> recoveries are used to estimate these parameters are referred to as the reference "base period."  These parameter estimates are derived through species-specific <a href = "https://framverse.github.io/fram_doc/calcs_glossary.html#Cohort_Analysis" target = "_blank" title = "Cohort analyses">cohort analyses</a>.  Each cohort analysis is a series of procedures that use <span title = "CWT: Coded wire tag">CWT</span> recoveries and base period catch and escapement data to “back-calculate,” or reconstruct, a pre-fishing cohort size for each stock using assumed natural mortality and incidental mortality rates.  See (Model Evaluation Workgroup, 2008) for a more detailed description of the cohort analysis procedures.

Model base period data for the Coho <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> is derived from fishery and escapement recoveries of <span title = "CWT: Coded wire tag">CWTs</span> and terminal area run size estimates for the return years 1986-1992 (Packer et al. 2007).  In 2006, the previously used base period data from 1986-1991 were re-analyzed, changes were made to the algorithm, and 1992-1997 catch year data were compiled.  A decision was made to only incorporate the 1992 catch year with the previous base period data, and thus the coho base period for return years 1986-1992 was generated.

### 3.1.2. Annual Data

Coho <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> uses five general types of input.  Three of these input types (<span title = "a. Cohort abundance; b. Fishery landed catch; d. Mark-selective fisheries">a, b, d</span>) are submitted annually to reflect projected stock abundances and proposed fishery regulations for the current model year.  The remaining two types of input (<span title = "c. Release-mortality rates; e. Other non-landed mortality rates">c, e</span>) are specifications for fishery-related mortalities that can change as more information becomes available through additional data collection or studies, but typically do not change annually.

**a.** *Cohort Abundance*:  For each stock unit, an annual abundance is obtained from a source that is independent of the model, typically in the form of an ocean age-3 run size (pre-fishing age-3 abundance in the ocean after natural mortality has been subtracted).  In a pre-season context these abundances come from annual forecasts, whereas in a post-season context the abundances are derived from estimates of actual returns. For coho, an initial stock abundance is needed for adult fish (age-3) by mark status.  

**b.** *Fishery Landed Catch*:  The model provides three options for setting the catch in a fishery: a quota, a fishery scaler, and a harvest rate (for Puget Sound and Washington coastal terminal fisheries). 

<u>Quota</u>:  Catch in the fishery is set equal to a numeric value input by the user.<br>
<u>Fishery Scaler</u>:  The fishery is scaled relative to the effort during the reference base period using a scaler value input by the user.  
<u>Harvest rate</u>:  Using the Puget Sound <span title = "TAMM: Terminal Area Management Module">TAMM</span>, a terminal area harvest rate can be applied to terminal area fisheries.

<span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> inputs for quota and fishery scaler can be identified as either a conventional retention fishery or a mark-selective fishery and modeled accordingly.  Modeling as a mark-selective fishery initiates additional calculations to estimate catches, encounters, and mortalities differently for marked and unmarked groups.

**c.** *Release Mortality Rates*:  This is the mortality associated with the release of landed fish from hook-and-line and other gear types. Release mortality rates are designated by species, geographic area, fishery type and gear type (Appendix 6). Release mortality is assessed when coho are not retained (“non-retention” or <a href = "https://framverse.github.io/fram_doc/calcs_glossary.html#ChinookCoho_Non-retention_(CNR)_Fisheries" target = "_blank" title = "CNR: Coho non-retention">CNR fisheries</a>) as well as in mark-selective fisheries. A number of studies have estimated release mortality for hook-and-line fisheries, and release mortality rates for troll and recreational fisheries in the ocean have been formally adopted by the <span title = "PFMC: Pacific Fishery Management Council">PFMC</span>. Release mortality in net fisheries with non-retention is estimated externally to <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> and provided as an input to the model.

**d.** *Mark-selective fisheries* have two additional variations of “release” mortality that are described as either the inappropriate retention of an unmarked fish or the release of a marked fish that consequently experiences release mortality.  The failure to release an unmarked fish is a user input to the model called “<u>Unmarked Retention Error</u>” (or Retention Error Rate) and is the proportion of the unmarked fish encountered that are retained.  The release of marked fish is a user input to the model called “<u>Marked Recognition Error</u>” and it is the proportion of the marked fish encountered that are released; these released marked fish are then subject to release mortality.  These rates are updated annually based on fishery monitoring data. 

**e.** *Other Non-landed Mortality Rates*:  This includes fishing-induced mortality not associated with directly handling fish.  Drop-off mortality occurs when fish in sport and troll hook-and-line fisheries drop off the hook before they are brought to the vessel yet die from hook injuries.   Drop-out mortality occurs when fish in commercial net fisheries are not brought on board but die from injury as a result of being netted.  For simplicity, both types are referred to as drop-off mortality in <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span>.  Net drop-out mortality rates vary depending on species, net type, or timing (pre-terminal or terminal) of the fishery.  In general, a 5% drop-off mortality rate is applied to the landed catch to account for “other non-landed mortalities” in hook-and-line fisheries (see **Appendix 6**).

# 4. Model Calculations 

## 4.1. Overview

<span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span>  processes information through a time step loop, beginning with time step 1 and ending with time step 5 for coho.  Within each time step, a series of four computational processes occur for each stock as depicted in Figure 1: (**1**) determine starting cohort size, (**2**) removal of natural mortality, (**3**) removal of pre-terminal mortalities, (**4**) removal of terminal fishery mortalities (time 5 only).

```{r coho flow chart image, echo=FALSE}
knitr::include_graphics(c("images/Coho_FRAM_flowchart.PNG"))
```

Figure 1.  Conceptual flow chart for the Coho <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> model.

## 4.2. Computational Processes

**Cohort Abundance**

<u>Process 1:  Cohort Abundance at the Start of the Time Step</u>

The starting cohort size in time step 1 is a product of two parameters: (*1*) the base period cohort size for stock *s* at age 3 in the first time period (<span title = "Base period cohort abundance estimate of stock s at age 3">$BPCohorts_{s,a \! = \! 3}$</span>) and (*2*) a stock and age-specific scaler (<span title = "Stock recruit scaler of stock s at age 3">$StockScalers_{s,a \! = \! 3}$</span>).  The scaler is an annual model input. 

<p>**(1)**<div style = "text-align:center"><span title = "Cohort abundance of stock s at age 3 during time step 1">$Cohort_{s,a \! = \! 3,t\!=\!1}$</span> $=$ <span title = "Base period abundance of stock s at age 3">$BPCohort_{s,a \! = \! 3}$</span> $\times$ <span title = "Stock recruit scaler of stock s at age 3">$StockScaler_{s,a \! = \! 3}$</span> </div> </p>
where <span title = "Cohort abundance of stock s at age 3 during time step 1">$Cohort_{s,a \! = \! 3,t\!=\!1}$</span> is the initial cohort size for stock *s*, age 3, during time step *t*=1.

Coho <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> only models age-3 fish (*a*=3). The starting cohort size is the projected number of age-3 fish in January of the fishing year for each stock.  All coho escape in the final time step (*t*=5) and thus are not aged in the model.

**Natural Mortality**

<u>Process 2: Natural mortality during each time step</u> <br>

During each time step, the stock-age cohort size at the start of the time step is decreased to account for natural mortality:

<p>**(2)** <div style = "text-align:center"><span title = "Cohort abundance of stock s at age 3 during time step t">$Cohort_{s,a \! = \! 3,t}$</span> $=$ <span title = "Cohort abundance of stock s at age 3 during time step t">$Cohort_{s,a \! = \! 3,t}$</span> $\times$ <span title = "Discrete natural mortality rate at age 3 and time step t">$(1-M_{a \! = \! 3,t})$</span> </div> </p>

where <span title = "Discrete natural mortality rate at age 3 and time step t">$M_{a \! = \! 3,t}$</span> is the discrete natural mortality rate for age 3 fish during time step *t* (Appendix 8).

**Pre-terminal Fishery Mortality**

<u>Process 3: Pre-terminal Fishery Mortality</u>

The remaining cohort is then subjected to removals by pre-terminal fisheries; both landed catch and non-landed mortalities associated with each fishery are calculated. <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> simulates fishery mortalities using different processes depending upon the type of fishery: retention fishery (non-selective), non-retention fishery, or mark-selective fishery. 

<u>**3a.** In regular retention fisheries (non-selective), landed catch is estimated by:</u>

<p>**(3)**<div style = "text-align:center"><span title = "Cohort abundance of stock s at age 3 in fishery f during time step t">$Catch_{s,a \! = \! 3,f,t}$</span> $=$ <span title = "Cohort abundance of stock s at age 3 during time step t">$Cohort_{s,a \! = \! 3,t}$</span> $\times$ <span title = "Base period exploitation rate for stock s at age 3 in fishery f during time step t">$BPER_{s,a \! = \! 3,f,t}$</span> $/times$ <span title = "Fishery scaler for fishery f during time step t">$FisheryScaler_{f,t}$</span> $\times$ <span title = "Portion vulnerable of stock s at age 3 in fishery f during time step t">$PV_{s,a \! = \! 3,f,t}$</span> $\times$ <span title = "Stock fishery rate scaler for stock s in fishery f during time step t">$SHRF_{s,f,t}$</span> </div> </p>

where:

- <span title = "Base period exploitation rate for stock s at age 3 in fishery f during time step t">$BPER_{s,a \! = \! 3,f,t}$</span> is the base period exploitation rate for stock *s*, at age 3, in fishery *f*, during time step *t*.
- <span title = "Fishery scaler for fishery f during time step t">$FisheryScaler_{f,t}$</span> is an annual model input that relates expected catch (or effort) in the model year back to average catch (or effort) druing the base period.
- <span title = "Portion vulnerable of stock s at age 3 in fishery f during time step t">$PV_{s,a \! = \! 3,f,t}$</span> is the portion of the stock cohort *s*, at age 3, during time step *t* that is of legal size in fishery *f* (i.e. portion vulnerable; PV). For coho, <span title = "PV: Portion vulnerable">PV</span> is always 1 and can be eliminated from the equation.
- <span title = "Stock fishery rate scaler for stock s in fishery f during time step t">$SHRF_{s,f,t}$</span> is the stock fishery rate scaler for stock *s* in fishery *f* during time step *t*. The <span title = "Stock fishery rate scaler">$SHRF$</span> is optional and can be used to adjust impacts for individual stocks in a fishery and time step; i.e., if <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> output for an individual stock significantly deviates from expectations, then the user can make adjustments by providing a <span title = "Stock fishery rate scaler">$SHRF$</span> scaler.

The <span title = "Fishery scaler for fishery f during time step t">$FisheryScaler_{f,t}$</span> is the foundation for the fishery simulation algorithms. <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> can evaluate two general types of fisheries: effort-based or catch-based. For effort-based fisheries, the <span title = "Fishery scaler for fishery f during time step t">$FisheryScaler_{f,t}$</span> is specified by the user to reflect expected effort during the model year relative to the average effort observed during the base period. For catch-based fisheries, the <span title = "Fishery scaler for fishery f during time step t">$FisheryScaler_{f,t}$</span> is computed by <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> to obtain a user-specified catch level (i.e. a quota).

<u>**3b.** Drop-off mortalities are estimated</u> by multiplying either **a**) landed catch in a non-selective retention fishery, or **b**) total encounters in a mark-selective fishery, by a user-specified drop-off mortality rate (<span title = "Drop-off mortality rate of fishery f">$DropRate_f$</span> see Appendix 7)

**a)** Non-selective retention fishery *f*:
<p>**(4a)**<div style = "text-align:center"><span title = "Drop-off mortality of stock s at age 3 in fishery f at time step t">$Dropoff_{s,a \! = \! 3,f,t}$</span> $=$ <span title = "Landed catch of stock s at age 3 in fishery f during time step t">$Catch_{s,a \! = \! 3,f,t}$</span> $\times$ <span title = "Drop-off mortality rate of fishery f">$DropRate_f$</span> </div> </p>
**b)** Mark-selective fishery *f*:
<p>**(4b)**<div style = "text-align:center"><span title = "Drop-off mortality of stock s at age 3 in fishery f at time step t">$Dropoff_{s,a \! = \! 3,f,t}$</span> $=$ <span title = "Number of legal encounters of stock s at age 3 in fishery f during time step t">$LegalEncounters_{s,a \! = \! 3,f,t}$</span> $\times$ <span title = "Drop-off mortality rate of fishery f">$DropRate_f$</span></div></p>

<u>**3c.** Coho non-retention (CNR) mortalities are estimated</u> for time periods when fishing is allowed, but the retention of coho is prohibited.

Non-retention mortalities are calculated external to the model, often derived using historical observations, and are model inputs in units of dead age-3 fish <span title = "Estimated coho non-retention mortalities in fishery f during time step t">$(EstCNRMorts_{f,t})$</span>. Non-retention mortalities by stock are then calculated in <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> by multiplying the total non-retention mortality by the stock proportion <span title = "Proportion of stock present">$(PropCatch)$</span>.

<p>**(5)**<div style = "text-align:center"><span title = "Coho non-retention mortalities of stock s in fishery f during time step t">$CNR_{s,f,t}$</span> $=$ <span title = "Estimated coho non-retention mortalities in fishery f during time step t">$EstCNRMorts_{f,t}$</span> $\times$ <span title = "Proportion present of stock stock s in fishery f during time step t">$PropCatch_{s,f,t}$</span> </div> </p>

<u>**3d.** Mark-selective fisheries</u> (MSF) require additional computations to calculate both the landed catch and the mortalities due to the release of fish.

To simplify calculations, the <span title = "SHRS: Stock fishery rate scaler">SHRS</span> are excluded from the below calculations:

For **marked stock** units, the landed catch is calculated using an additional term to account for marked-recognition error (the release of a marked fish) and is fishery and time step specific <span title = "Marked-recognition error in fishery f during time step t">$(mre_{f,t})$</span>:

<p>**(6a)**<div style = "text-align:center"><span title = "Mark-selective fishery catch of stock s at age 3 in fishery f during time step t">$MSFCatch_{s,a \! = \! 3,f,t}$</span> $=$ <span title = "Cohort abundance of stock s at age 3 during time step t">$Cohort_{s,a \! = \! 3,t}$</span> $\times$ <span title = "Base period exploitation rate of stock s at age 3 in fishery f during time step t">$BPER_{s,a \! = \! 3,f,t}$</span> $\times$ <span title = "Fishery scaler of fishery f at time step t">$FisheryScaler_{f,t}$</span> $\times (1 \ -$ <span title = "Marked-recognition error in fishery f during time step t">$mre_{f,t})$</span> </div> </p>

For **unmarked stock** units, the landed catch is calculated using an additional term to account for unmarked retention error (retaining an unmarked fish in a mark-selective fishery) and is fishery and time step specific <span title = "Unmarked retention error for fishery f during time step t">$(ure_{f,t})$</span>:

<p>**(6b)**<div style = "text-align:center"><span title = "Mark-selective fishery catch of stock s at age 3 in fishery f during time step t">$MSFCatch_{s,a \! = \! 3,f,t}$</span> $=$ <span title = "Cohort abundance of stock s at age 3 during time step t">$Cohort_{s,a \! = \! 3,t}$</span> $\times$ <span title = "Base period exploitation rate of stock s at age 3 in fishery f during time step t">$BPER_{s,a \! = \! 3,f,t}$</span> $\times$ <span title = "Fishery scaler of fishery f at time step t">$FisheryScaler_{f,t}$</span> $\times$ <span title = "Unmarked-retention error for fishery f during time step t">$ure_{f,t}$</span> </div> </p>

Equations used to calculate adult release mortalities <span title = "Adult release mortalities">$(AdultRelMort)$</span> in mark-selective fisheries must account for marked recognition <span title = "Marked-recognition error">$(mre)$</span> and unmarked retention error <span title = "Unmarked retention error">$(ure)$</span> for marked and unmarked stock units and utilize fishery and time step-specific release mortality rates <span title = "Specific fishery mortality rate of fishery f during time step t">$(sfm_{f,t})$</span> (Appendix 6).

<p>**(7a) Marked:**<div style = "text-align:center"><span title = "Adult release mortalities of stock s at age 3 in fishery f during time step t">$AdultRelMort_{s,a \! = \! 3,f,t}$</span> $=$ <span title = "Cohort abundance of stock s at age 3 during time step t">$Cohort_{s,a \! = \! 3,t}$</span> $\times$ <span title = "Base period exploitation rate for stock s at age 3 in fishery f during time step t">$BPER_{s,a \! = \! 3,f,t}$</span> $\times$ <span title = "Fishery scaler of fishery f at time step t">$FisheryScaler_{f,t}$</span> $\times$ <span title = "Marked recognition error in fishery f">$mre_f$</span> $\times$ <span title = "Specific release mortality rate of fishery f during time step t">$sfm_{f,t}$</span> </div> </p>

<p>**(7b) UnMarked:**<div style = "text-align:center"><span title = "Adult release mortalities of stock s at age 3 in fishery f during time step t">$AdultRelMort_{s,a \! = \! 3,f,t}$</span> $=$ <span title = "Cohort abundance of stock s at age 3 during time step t">$Cohort_{s,a \! = \! 3,t}$</span> $\times$ <span title = "Base period exploitation rate for stock s at age 3 in fishery f during time step t">$BPER_{s,a \! = \! 3,f,t}$</span> $\times$ <span title = "Fishery scaler of fishery f at time step t">$FisheryScaler_{f,t}$</span> $\times (1 \ -$ <span title = "Unmarked retention error in fishery f">$ure_f)$</span> $\times$ <span title = "Specific release mortality rate of fishery f during time step t">$sfm_{f,t}$</span> </div> </p>

Drop-off mortalities in mark-selective fisheries are calculated by multiplying the drop-off mortality rate with the number of legal encounters, as described in process 3b above.

<u>**3e.** All pre-terminal fishery mortalities</u> in time step *t* for stock *s* at age 3 are totaled <span title = "TotMort: Total pre-terminal fishery mortalities">$(TotMort)$</span> and the size of the cohort is reduced accordingly. Since the coho model contains only age-3 mature fish, the summing of fishery mortalities occurs only once in each time step.

<p>**(8)**<div style = "text-align:center"><span title = "Total pre-terminal fishery mortalities for stock s at age 3 during time step t">$TotMort_{s,a \! = \! 3,t}$</span> $=$ $\displaystyle\sum_f$ <span title = "Landed catch of stock s at age 3 in fishery f during time step t">$(Catch_{s,a \! = \! 3,f,t}$</span> $+$ <span title = "Drop-off mortality of stock s at age 3 in fishery f at time step t">$Dropoff_{s,a \! = \! 3,f,t}$</span> $+$ <span title = "Adult release mortalities of stock s at age 3 in fishery f during time step t">$AdultRelMort_{s,a \! = \! 3,f,t}$</span> $+$ <span title = "Non-retention mortality of stock s at age 3 in fishery f during time step t">$CNR_{s,a \! = \! 3,f,t})$</span></div></p>

The remaining cohort is then calculated as:

<p>**(9)**<div style = "text-align:center"><span title = "Cohort abundance of stock s at age 3 during time step t">$Cohort_{s,a \! = \! 3,t}$</span> $=$ <span title = "Cohort abundance of stock s at age 3 during time step t">$Cohort_{s,a \! = \! 3,t}$</span> $-$ <span title = "Total pre-terminal fishery mortalities for stock s at age 3 during time step t">$TotMort_{s,a \! = \! 3,t}$</span> </div> </p>

Fisheries during time steps 1 through 4 are considered to be on immature fish and, by default, all coho fisheries in time step 5 are on mature fish.  Thus, 
<div style = "text-align:center"><span title = "Mature cohort abundance of stock s at age 3 during time step 5">$MatureCohort_{s,a \! = \! 3,t \! = \! 5}$</span> $=$ <span title = "Cohort abundance of stock s at age 3 during time step 5">$Cohort_{s,a \! = \! 3,t \! = \! 5}$</span>. </div>

<u>Process 4: Terminal Fishery Mortality</u>

Terminal fishery mortality is calculated for the mature cohort only, using the same equations as for pre-terminal fishery mortality.  Fishery mortalities are summed, and the remainder of the mature cohort constitutes the escapement from <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> fisheries. Since only age-3 adult coho are modeled and the mature time step is always 5, age and time step parameters can be eliminated from the equations.

<p>**(10)**<div style = "text-align:center"><span title = "<span title = "Total terminal fishery mortality for stock s at age 3 during time step t">$TotTermMort_{s,a \! = \! 3,t \! = \! 5}$</span> $=$ $\displaystyle\sum_{f \in terminal}$ <span title = "Landed catch of stock s at age 3 in fishery f during time step 5">$(Catch_{s,a \! = \! 3,f,t \! = \! 5}$</span> $+$ <span title = "Drop-off mortality of stock s at age a in fishery f at time step t">$Dropoff_{s,a,f,t}$</span> $+$ <span title = "Adult release mortalities of stock s at age a in fishery f during time step t">$AdultRelMort_{s,a,f,t}$</span> $+$ <span title = "Non-retention mortality of stock s at age a in fishery f during time step t">$CNR_{s,a,f,t})$</span> </div> </p>

<p>**(11)**<div style = "text-align:center"><span title = "Escapement of stock s at age a during time step t">$Escapement_{s,a,t}$</span> $=$ <span title = "Mature cohort abundance of stock s at age a during time step t">$MatureCohort_{s,a,t}$</span> $-$ <span title = "Total terminal fishery mortality for stock s at age a during time step t">$TotTermMort_{s,a,t}$</span></div> </p>

Escapement is defined as the number of fish that remain in the mature cohort after removal of all terminal-area fishery related mortality. For coho modeling, which includes freshwater fisheries, escapement represents the adult spawning abundance if mortality during “pre-spawning” holding time is negligible.

<u> Process 5: <span title = "TAMM: Terminal Area Management Module">TAMM</span> Iterations</u>

If the last time step has been completed, <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> receives terminal fishery impacts (Figure 3) from the Terminal Area Management Module (TAMM) (**Chapter 5**).  <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> then estimates the terminal fishery impacts using the numbers from <span title = "TAMM: Terminal Area Management Module">TAMM</span> and compares that to the original <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> results.  If these numbers are equal (less than 0.1% or fewer than 4 fish difference), the model is done.  If these numbers are not equal, an iterative process is initiated during which <span title = "TAMM: Terminal Area Management Module">TAMM</span> terminal fishery impacts are used to adjust <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> terminal fishery impacts until there is convergence.  

Finally, <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> sends terminal marine and freshwater run sizes and fishing mortality to the <span title = "TAMM: Terminal Area Management Module">TAMM</span> file for use in additional calculations and final reporting.

## 4.3. Processing Schematic

To facilitate the understanding of the sequencing of <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> processing steps, Table 3 provides an example of how a stock’s cohort is processed through time step from starting cohort to escapement.

The starting cohort in time step 1 is first reduced by natural mortality. The remaining cohort is vulnerable to pre-terminal fisheries. Coho not caught become the starting cohort of the next time step. This cycle repeats until time step 5, when 100% of coho mature after pre-terminal fishing.  The mature cohort is susceptible to terminal fisheries. Coho not caught after pre-terminal and terminal fisheries in time step 5, go to escapement.

Table 3. Example values of Coho FRAM processing steps for a stock.
```{r coho process schematic image, echo=FALSE}
knitr::include_graphics(c("images/Coho_FRAM_process_schematic.PNG"))
```

## 4.4. Exploitation Rate Calculation

<span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> calculates stock-specific mortalities and escapements that are ultimately used to compute exploitation rates (ER). Exploitation rate calculations are not part of the main <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> algorithms and are not calculated by <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span>  Exploitation rates are computed from <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> or <span title = "TAMM: Terminal Area Management Module">TAMM</span> output as the sum of all fishery mortalities divided by fishery mortalities plus escapement.

**(12)**
$$ER_s = \frac{\displaystyle\sum\limits_{t} TotMort_{s,a \! = \! 3,t}}{\displaystyle\sum\limits_{t} TotMort_{s,a \! = \! 3,t} + Escapement_{s}}$$

## 4.5. Bias Corrected Mark-Selective Fishery Equations for Coho

The total number of unmarked mortalities in <span title = "MSF: Mark-selective fishery">MSF<span> is underestimated by models relying on the linear relationship between exploitation rate and release-mortality rate.  The actual mortality rate of unmarked fish is an increasing function of the time step-specific exploitation rate.  When <span title = "MSF: Mark-selective fishery">MSFs</span> operate during a modeled time step, unmarked mortalities are underestimated because released fish may encounter the fishing gear more than once during the modeled time step and the unmarked-to-marked fish ratio for all fish in the pool increases during the time step as a result of the selective removal of marked fish in a mark-selective fishery.  See (Conrad, Hagen-Breaux, & Yuen, 2013) for a detailed description of the equations.

Bias adjusted exploitation rates for marked and unmarked stock units are calculated as:

**(13)**
$$ER_{s,t} = 1 - (1 - \sum_f(ER_{s,f,t}^M)^{\delta_{s,t}^W})$$

**(14)**

$$\delta_{s,t}^w = \sum_f \frac{ER_{s,f,t}^M}{\displaystyle\sum_f ER_{s,f,t}^M} \times \delta_f$$

where:

- <span title = "Marked exploitation rate for stock s in fishery f during time step t">$ER^M_{s,f,t}$</span> is the marked exploitation rate of stock *s* in fishery *f* during time step *t*
- <span title = "Release mortality rate in (MSF) fishery f">$\delta_f$</span> is the release mortality rate in <span title = "MSF: Mark selective fishery">(MSF)</span> fishery *f*
- <span title = "Weighted release mortality rate of stock s during time step t">$\delta^W_{s,t}$</span> is the weighted release mortality rate for stock *s* during time step *t*
- <span title = "Marked exploitation rates summed over all fisheries for stock s during time step t">$\sum_f ER^M_{s,t}$</span> is the marked exploitation rates summed over fisheries for stock *s* at time step *t*

These exponential equations were implemented to estimate exploitation rates in Coho <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> for stocks experiencing release in mark-selective fisheries during a given time step.

# 5. Terminal Area Management Module

The <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> program interacts with the <span title = "TAMM: Terminal Area Management Module">TAMM</span>, a species-specific Microsoft Excel file, which allows users to specify alternative terminal fishery inputs and to calculate impacts on a finer level of resolution than <span title = "FRAM: Fishery Regulation Assessment Model">FRAM.</span> <span title = "TAMM: Terminal Area Management Module">TAMM</span> has separate sections for each of the six Puget Sound terminal regions defined in the Puget Sound Salmon Management Plan (PSSP 1985, Table 3) for the State of Washington and the Treaty Tribes of Puget Sound. <span title = "TAMM: Terminal Area Management Module">TAMM</span> is best understood in its historic context. It is a terminal-area-centric fisheries model. Prior to <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> development, information of stock-specific fishery impacts was not readily available. Management was based on terminal run reconstructions that assigned 100% of terminal catches to the local stock and computed terminal harvest rates as catch in the terminal area divided by terminal run size. To this day, most <span title = "TAMM: Terminal Area Management Module">TAMM</span> inputs for terminal marine fisheries are still derived by including non-local stock impacts. <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> takes these inputs from <span title = "TAMM: Terminal Area Management Module">TAMM</span> and accounts for non-local stock impacts before reporting stock specific impacts back to <span title = "TAMM: Terminal Area Management Module">TAMM.</span> <span title = "TAMM: Terminal Area Management Module">TAMM</span> also develops alternative terminal inputs and modeling for the Washington coast, as well as generating inputs for Columbia River models. Additional <span title = "TAMM: Terminal Area Management Module">TAMM</span> functionality also supports development of unique regional management goals and allows managers the flexibility to analyze and report <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> model output according to their needs. 

Table 4. Puget Sound Terminal Management Regions.
```{r coho terminal management regions table, echo = FALSE}
dplyr::tibble(
  `Management Regions` = c(
    "Nooksack-Samish", "Skagit", "Stillaguamish-Snohomish", 
    "South Sound", "Hood Canal", "Strait of Juan de Fuca")
) |> gt::gt()
```
<br>
Common <span title = "TAMM: Terminal Area Management Module">TAMM</span> features:

- Receive inputs for <span title = "TAMM: Terminal Area Management Module">TAMM</span> terminal fisheries 
- Receive input for <span title = "TAMM: Terminal Area Management Module">TAMM</span> stock management criteria (updated annually)
- Provide fishery inputs to <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> during <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span>-<span title = "TAMM: Terminal Area Management Module">TAMM</span> iterations
- Receive <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> output of fishery impacts and abundances 
- Use <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> output to complete <span title = "TAMM: Terminal Area Management Module">TAMM</span> fishery impact modeling for Puget Sound and the Washington Coast
- Generate <span title = "TAMM: Terminal Area Management Module">TAMM</span> reports of combined <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> and <span title = "TAMM: Terminal Area Management Module">TAMM</span> fishery impacts 


<span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> iteratively finds the fishery scalers that produce the same catches <span title = "Catch calculated within FRAM">$(Catch_{FRAM})$</span> as those supplied by <span title = "TAMM: Terminal Area Management Module">TAMM</span> <span title = "Catch calculated within TAMM">$(Catch_{TAMM})$</span> in Puget Sound and Washington coastal fisheries (Figure 3).  <span title = "TAMM: Terminal Area Management Module">TAMM</span> catches are either directly input into <span title = "TAMM: Terminal Area Management Module">TAMM</span> as catch values or calculated by <span title = "TAMM: Terminal Area Management Module">TAMM</span> with user input harvest rates (HR) multiplied by a unique terminal run size definition (TRS).  The <span title = "TRS: Terminal run size">TRS</span> for a <span title = "TAMM: Terminal Area Management Module">TAMM</span> region/stock represents ‘run-to-the-river’ of a stock plus catches of all stocks in the terminal fisheries designated for that region. In coho <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span>-<span title = "TAMM: Terminal Area Management Module">TAMM</span>, terminal run size definitions can be customized (using the TAAETRSList table in the MS Access database) and must be aligned with calculations used for each model input.

<span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> calculations for each terminal area:

- Sum escapements over appropriate time steps
- Add terminal catches <span title = "Catch calculated within FRAM">$(Catch_{FRAM})$</span> to calculate <span title = "TRS: Terminal run size">TRS</span> (includes non-local stocks)
- Calculate the <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> fishery scaler that produces the <span title = "Catch calculated within TAMM">$Catch_{TAMM}$</span>:
<div style = "text-align:center"><span title = "Fishery scaler for a given area at a given time step">$FisheryScaler(area, time step)$</span> = <span title = "Catch calculated in TAMM for a given area at a given time step">$Catch_{TAMM}(area, time step)$</span> $\div$ <span title = "Catch calculated in FRAM for a given area at a given time step">$Catch_{FRAM}(area, time step)$</span> </div>
- Rerun <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> and repeat these steps until <span title = "Catch calculated within TAMM">$Catch_{TAMM}$</span> is within 0.1% (or fewer than 4 fish) of <span title = "Catch calculated within FRAM">$Catch_{FRAM}$</span>.

```{r coho FRAM TAMM flow chart image, echo=FALSE}
knitr::include_graphics(c("images/FRAM_TAMM_flowchart.PNG"))
```

Figure 3.  Conceptual flow chart for <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span>-<span title = "TAMM: Terminal Area Management Module">TAMM</span> calculations.

# 6. Backwards <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span>

Backwards <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> <a href = "https://framverse.github.io/fram_doc/calcs_glossary.html#Backwards_FRAM_(BkFRAM)" target = "_blank" title = "Backwards FRAM">(bkFRAM)</a> is a utility that determines <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> starting cohorts when estimates of escapements  and fishery catches (landed and non-retention) are provided.  The program iteratively adjusts stock recruit scalers (a surrogate for starting cohorts, see equation below) and runs <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> forward until the resulting escapements match the target escapements. Starting cohorts are in units of January-age-3 adult fish. 

Post-season <span title = "bkFRAM: backwards FRAM">bkFRAM</span> runs are generally conducted to create the starting cohorts that result in observed escapements given known fishery impacts. These cohorts are needed to calculate exploitation rates.  

The calculation is based on adding time step fishery mortalities of a stock to the escapement target, expanding for natural mortality occurring in each time step, and working backwards from time step 5 to time step 1.  The mortalities are calculated by summing landed, drop-off, and non-retention mortalities over all fisheries for a stock and time step.
 
Mark-selective fishery bias correction calculations used for coho produce an error when the exploitation rate exceeds 100%.  This frequently occurs during early iterations, because the abundances from the seed run (usually the pre-season run) are not related to the post-season fishery catches (e.g., low pre-season forecasts but high post-season terminal catches).  To avoid errors, the first iteration initiates starting cohorts scaled 1000 times greater than the base period abundance.  Additionally, the first 7 iterations are run without bias correction to get sufficiently close to the target escapement, before adding mark-selective fishing bias calculations for all remaining iterations. 

<p>**(16)**<div style = "text-align:center"><span title = "Stock scaler of stock s at age 3">$StockScaler_{s,a \! = \! 3}$</span> $=$ <span title = "Backward FRAM target for stock s">$((((((BkTarget_s$</span> $+$ <span title = "Total mortality of stock s at age 3 during time step 5">$(TotMort_{s,a \! = \! 3,t \! = \! 5}$</span> $+$ <span title = "Total terminal mortality for stock s at age 3 during time step 5">$TotTermMort_{s,a \! = \! 3,t \! = \! 5})$</span> $\div (1 -$ <span title = "Discrete natural mortality at age 3 during time step 5">$M_{a \! = \! 3,t \! = \! 5})$</span> $+$ <span title = "Total mortality of stock s at age 3 during time step 4">$TotMort_{s,a \! = \! 3,t \! = \! 4})$</span> $\div (1 -$ <span title = "Discrete natural mortality at age 3 during time step 4">$M_{a \! = \! 3,t \! = \! 4})$</span> $+$ <span title = "Total mortality of stock s at age 3 during time step 3">$TotMort_{s, a \! = \! 3,t \! = \! 3})$</span> $\div (1 -$ <span title = "Discrete natural mortality at age 3 during time step 3">$M_{a \! = \! 3,t \! = \! 3})$</span> $+$ <span title = "Total mortality of stock s at age 3 during time step 2">$TotMort_{s,a \! = \! 3,t \! = \! 2})$</span> $\div (1 -$ <span title = "Discrete natural mortality at age 3 during time step 2">$M_{a \! = \! 3,t \! = \! 2})$</span> $+$ <span title = "Total mortality of stock s at age 3 during time step 1">$TotMort_{s,a \! = \! 3,t \! = \! 1})$</span> $\div (1 -$ <span title = "Discrete natural mortality at age 3 during time step 1">$M_{a \! = \! 3,t \! = \! 1}))$</span> $\div$ <span title = "Base period starting cohort abundance of stock s at age 3">$BPCohort_{s,a \! = \! 3}$</span> </div> </p>

where:

- $BkTarget$ is the backwards FRAM run size/escapement target
- $BPCohort$ is the base period starting cohort abundance
- $StockScaler$ is the stock recruit scaler (abundance)

The program iterates until the <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> escapement is within one fish of the target stock escapement and then terminates the iteration process. 

<p>**(17)**<div style = "text-align:center"><span title = "Escapement estimate from a forward FRAM calculation for stock s at age 3">$| \ FRAMescapement_{s,a \! = \! 3}$<span> $-$ <span title = "Backwards FRAM escapement or (extreme) terminal run size target of stock s at age 3">$BkTarget_{s,a \! = \! 3} \ |$</span> $\le 1$ </div> </p>

where:

- <span title = "Escapement estimate from a forward FRAM calculation">$FRAMescapement$</span> is the escapement resulting from a forward <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> run.

# 7. Output Reports

Model results are available in <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> screen reports viewed within the software, <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> reports, <span title = "TAMM: Terminal Area Management Module">TAMM</span> Microsoft Excel files, or can be extracted from the species-specific Microsoft Access database associated with the <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> run.  <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> reports include summaries of projected catch and mortalities by fishery, stock, and age. The <span title = "TAMM: Terminal Area Management Module">TAMM</span> files provide comprehensive summaries of fishery mortalities, exploitation rates, run sizes, and escapements for key stocks in the <span title = "PFMC: Pacific Fishery Management Council">PFMC</span> and North of Falcon (NOF) annual pre-season planning process, as well as Canadian coho stocks relevant to the Pacific Salmon Treaty (PST). For a full scope of <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> report generating functions, refer to the online <span title = "FRAM: Fishery Regulation Assessment Model">FRAM</span> User Manual.
