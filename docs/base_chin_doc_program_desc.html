<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Base Period Documentation - Program Descriptions</title>

<script src="site_libs/header-attrs-2.22/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="site_libs/font-awesome-6.4.0/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.4.0/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
      .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="rmarkdown.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">FRAM Documentation</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Overview</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Model Detail
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="calcs_data_chin.html">Chinook</a>
    </li>
    <li>
      <a href="calcs_data_coho.html">Coho</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Pre and Post Season FRAM
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="apps_chin.html">Chinook</a>
    </li>
    <li>
      <a href="apps_coho.html">Coho</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Base Period
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">Chinook</a>
      <ul class="dropdown-menu" role="menu">
        <li>
          <a href="base_chin_doc_intro.html">Introduction</a>
        </li>
        <li>
          <a href="base_chin_doc_calibration.html">Calibration Processes</a>
        </li>
        <li>
          <a href="base_chin_doc_data.html">Model Data</a>
        </li>
        <li>
          <a href="base_chin_doc_qaqc_or.html">QA/QC - Outreach</a>
        </li>
        <li>
          <a href="base_chin_doc_program_desc.html">Program Descriptions</a>
        </li>
        <li>
          <a href="base_chin_doc_update_cycle.html">Update Cycle</a>
        </li>
        <li>
          <a href="base_chin_doc_implications.html">Implications</a>
        </li>
        <li>
          <a href="base_chin_doc_results.html">Results</a>
        </li>
        <li>
          <a href="base_chin_doc_appendix.html">Appendices</a>
        </li>
      </ul>
    </li>
    <li>
      <a href="base_coho.html">Coho</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    User Manual
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="user_prereq.html">Prerequisites</a>
    </li>
    <li>
      <a href="user_basic_forward_run.html">A basic run</a>
    </li>
    <li>
      <a href="user_main_menu_full.html">Main menu options</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    References
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="calcs_glossary.html">Glossary</a>
    </li>
    <li>
      <a href="calcs_appendices.html">Appendices</a>
    </li>
    <li>
      <a href="calcs_citations.html">Supporting Documents</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/FRAMverse/fram_doc">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Base Period Documentation - Program Descriptions</h1>
<h4 class="author"></h4>

</div>


<div id="program-descriptions" class="section level1">
<h1>Program Descriptions</h1>
<p>Angelika</p>
<div id="frambuilder" class="section level2">
<h2>FRAMBuilder</h2>
<div id="requirements" class="section level3">
<h3>Requirements</h3>
</div>
</div>
<div id="main-calibration-program" class="section level2">
<h2><span id="CP">Main Calibration Program</span></h2>
<p>For the development of the new base period, the original calibration programs were rewritten using “Visual Studio.net”. The original programs were developped in QBasic and fragmented into many separate programs, requiring substantial user effort to create and edit program input files. Various processes were undocumented and disjointed. In many cases the output from one program was used to create the input file for the next program in the estimation process. Any data or selection changes usually resulted in re-running all components of the system. The new program was written in Visual Basic and consolidated the entire calibration into one application. Input and output is now stored in the same Access database. Data editing between runs is kept to a minimum. Once the required data is updated in the database, a new base period can be created in minutes. The new program has two main functions:</p>
<ul>
<li><p>Produce all the output data needed to populate the FRAM model with a new base period<br> The program can be run with 4 different options</p>
<ul>
<li><p>Out-of-Base (OOB) run</p></li>
<li><p>First OOB then all-stocks run</p></li>
<li><p>All-stocks run</p></li>
<li><p>Run without escapement and fishery expansions</p></li>
</ul></li>
<li><p>Create a transfer database for easy import of base period data into the main FRAM database The user has several options to create output</p></li>
</ul>
<div id="requirments" class="section level3">
<h3>Requirments</h3>
<p>The code for the program is posted in a <a href="https://github.com/Angelikahagen/MainCalibrationProgram">GitHub repository</a>. <br> To produce a new base period two files are required:</p>
<ul>
<li><p>Executable: MainCalibration.exe <br> Please see <a href="https://github.com/Angelikahagen/MainCalibrationProgram/blob/master/bin/x86/Debug/MainCalibration.exe">the GitHub repositiory</a> to download the executable.</p></li>
<li><p>Access Calibration Database: CalibrationSupport_xxx.mdb. <br> Please see chapter <a href="https://github.com/FRAMverse/fram_doc/tree/bp_documentation/docs/base_chin_doc_appendix.html#Database_Tables" target="_blank">Database Tables </a> for a description of the tables. Please contact a member of the FRAM team at WDFW or NWIFC for assistance with obtaining this file.</p></li>
</ul>
<p>To transfer calibration output into FRAM an additional transfer database is required.</p>
<ul>
<li>Access Transfer Database: NewCalibrationBasePeriodTransfer.mdb<br> Please contact a member of the FRAM team at WDFW or NWIFC for assistance with obtaining this file.</li>
</ul>
</div>
<div id="prerequisites" class="section level3">
<h3>Prerequisites</h3>
<p>Update all input database tables of the calibration database. These are listed in Appendix table <a href="https://framverse.github.io/fram_doc/base_chin_doc_appendix.html#Table_Description"> Table Description </a>.</p>
<p>Make sure that tables <code>CWT_AllOOB</code> and <code>CWTAll</code> contain the latest FRAMBuilder output.</p>
</div>
<div id="considerations" class="section level3">
<h3>Considerations</h3>
<p>For an OOB run the <code>FishScaler</code> table is updated in an iterative process whereupon calibration output is imported into FRAM, FRAM is run (see chapter <a href="https://framverse.github.io/fram_doc/base_chin_doc_program.html#Instructions_for_Producing_a_New_Base_Period_(specific)"> Instructions for Producing a New Base Period </a>) and updated fish scalers from these runs are pasted into the calibration database.</p>
<p>In order to update the <a href="https://framverse.github.io/fram_doc/base_chin_doc_glossary.html#Model-Stock_Proportion_(MSP)">MSP</a> conduct a “Total Run”. There are three tables in the calibration database that exisit in a “marked version” and a “total version”. These tables are <code>BasePeriodCatch</code>, <code>BasePeriodEscapements</code>, and <code>NonRetention</code>. When running a “TotalRun”, the tables with the total (marked + unmarked) values, need to have these names, when running a “Marked Run” the marked tables need to have these names. This will sometimes require renaming <code>BasePeriodCatch_Tot</code> to <code>BasePeriodCatch</code>, <code>BasePeriodEscapements_Tot</code> to <code>BasePeriodEscapements</code>, and <code>NonRetention_Tot</code> to <code>NonRetention</code>. <br> Run the calibration program. This will updated <code>ModelStockProportion</code> in table <code>BasePeriodCatch</code>. Before running the main (marked only) calibration, rename the tables with the marked values to the original table names. For more information visit sections <a href="https://framverse.github.io/fram_doc/base_chin_doc_calibration.html#Fishery Model_Stock_Proportion_(MSP)">Fishery Model Stock Proportion</a> and <a href="https://framverse.github.io/fram_doc/base_chin_doc_program_desc.html#Instructions_for_Producing_a_New_Base_Period_(specific)">Instructions for Producing a New Base Period</a>.</p>
</div>
<div id="conducting-a-run-generic" class="section level3">
<h3>Conducting a Run (generic)</h3>
<p>Upon selecting the executable, the program opens to the Main Menu also titled “Start Form”.</p>
<div class="figure">
<img src="images/CalProg1.JPG" alt="Figure xxx. Main Menu" width="400px" height="300px" />
<p class="caption">
Figure xxx. Main Menu
</p>
</div>
<p>The user is presented with four run options.<br></p>
<ul>
<li><p>Process only Out of Base Stocks When this option is selected the program only processes OOB stocks. The user selects the database table with the OOB Frambuilder recoveries. The program runs <a href="https://framverse.github.io/fram_doc/base_chin_doc_calibration.html#Out-of-Base_Procedures" target="_blank">OOB procedures</a> to the step where OOB recoveries are merged over brood years. At this point the user has the option to provide brood year weights. If no weights are provided each year receives the same weight.</p>
<div class="figure">
<img src="images/CalProg13.JPG" alt="Figure xxx. Brood Year Weighting Menu" width="400px" height="300px" />
<p class="caption">
Figure xxx. Brood Year Weighting Menu
</p>
</div>
<p>Selecting <code>Update</code> processes the new weights, <code>Cancel</code>clears out updated weights, and <code>Close</code>uses the existing (not updated) weights. Please see chapter <a href="https://framverse.github.io/fram_doc/base_chin_doc_calibration.html#Merge_OOB_CWTs_over_brood_years" target="_blank">Merging OOB CWTs over brood years</a>for more information about merging CWT recoveries. After merging estimated CWT recoveries over brood years, the program saves them in table <code>CWTOOBMerged</code> of the calibration database.</p></li>
<li><p>Process Out of Base Stocks then All Stocks<br> This option represents a typical calibration cycle that contains in-base as well as OOB stocks. The program first processes OOB recoveries, before merging them into the dataset with the in-base recoveries and conducting a calibration as described in the <a href="https://framverse.github.io/fram_doc/base_chin_doc_calibration.html" target="_blank">calibration </a> section of this documentation.</p></li>
<li><p>Process only All Stocks<br> If the calibration does not contain OOB stocks, then this option will produce a complete base period without running OOB procedures.</p></li>
<li><p>Cohort Reconstruction w/o expansions<br> Selecting this option produces cohort reconstructions and base period exploitation rates without escapement and fishery expansions; i.e., expansions are set to 1. <strong>Each stock can be processed independent of other stocks</strong> as the program does not expand recoveries to match the catch of all the stocks in a fishery. This procedure is akin to how the <a href="https://framverse.github.io/fram_doc/calcs_glossary.html#Chinook_Technical_Committee_(CTC)" target="_blank">CTC</a> conducts its exploitation rate analysis.</p></li>
</ul>
After selecting a run option the user presses the “Run” button. This will open the file selection menu.
<div class="figure">
<img src="images/CalProg2.JPG" alt="Figure xxx. File Selection Menu" width="400px" height="300px" />
<p class="caption">
Figure xxx. File Selection Menu
</p>
</div>
<p>Select <code>Open Support File</code>. This brings up a file explorer. Navigate to the directory with the calibration support database, select, and press <code>Open</code>. You will be prompted to select the table with the CWT recoveries for the desired run type.</p>
<div class="figure">
<img src="images/CalProg3.JPG" alt="Figure xxx. Prompt to Select CWT Table" width="500px" height="400px" />
<p class="caption">
Figure xxx. Prompt to Select CWT Table
</p>
</div>
<p>The database table names and fields are loaded into the screen. Select the table and hit <code>Run</code>.</p>
<div class="figure">
<img src="images/CalProg4.JPG" alt="Figure xxx. Populated File Selection Menu" width="500px" height="400px" />
<p class="caption">
Figure xxx. Populated File Selection Menu
</p>
</div>
<p>While the program runs, it may provide several feedback messages. The first message results from error check procedures. The program eliminates CWT recoveries of stocks without a legal population size for the age, fishery, and time step combination the recovery was made. The warning message prompts the user to examine an output file, errfile.txt, for more information about eliminated recoveries.</p>
<div class="figure">
<img src="images/CalProg5.JPG" alt="Figure xxx. Warning Message No Legal Population Size" width="500px" height="200px" />
<p class="caption">
Figure xxx. Warning Message No Legal Population Size
</p>
</div>
<p>Another warning message occurs if catch is missing for a fishery and time step that has actual or surrogate recoveries. Without catch, the program cannot produce base period exploitation rates. A small catch will remedy this situation and provide an exploitation rate without greatly affecting cohort sizes. This situation can occur for non-retention fisheries, where catch is illegal to retain, but BPERs are desirable to model non-retention impacts. These fisheries are usually modeled through the use of surrogate fisheries that provides the necessary CWT recoveries.</p>
<div class="figure">
<img src="images/CalProg6.JPG" alt="Figure xxx. Warning Message Missing Catch" width="500px" height="200px" />
<p class="caption">
Figure xxx. Warning Message Missing Catch
</p>
</div>
<p>A message is also produced for fisheries and time steps where base period catch exists, but CWT recoveries are lacking. These are usually fisheries that have designated surrogates. If this is not the case, a surrogate needs to be introduced.</p>
<div class="figure">
<img src="images/CalProg7.JPG" alt="Figure xxx. Warning Message Missing CWTs" width="500px" height="200px" />
<p class="caption">
Figure xxx. Warning Message Missing CWTs
</p>
</div>
<p>When the run has completed in returns to the main menu where the user can exit the program or produce output for the newly created base period.</p>
</div>
<div id="transferring-output" class="section level3">
<h3>Transferring Output</h3>
<p>When selecting <code>Export</code> on the main menu screen, the program transfers new base period output into a separate database used to easily import the new base period into a FRAM database. At this stage, model output is converted from a marked 39 stock structure to a marked and unmarked 78 stock structure. Each stock is divided into an unmarked (uneven stock ID) and a marked (even stock ID) component, effectively doubling the number of stocks. The transfer function re-numbers the stocks such that the new stock number equals old stock number * 2 -1 for unmarked, and old stock number * 2 for marked. The new unmarked cohort size is the same as the marked cohort size, thus doubling cohort sizes. This is un-problematic as cohort sizes are recomputed at the beginning of every FRAM run. All other variables that have a stock-specific parameter (BPERs, growth functions, maturation rates, etc.) are also doubled to have values for unmarked stock components. The values are again recycled from the marked stock components. This handling follows one of the main modeling assumptions; that marked stock components are acceptable surrogates for unmarked populations.</p>
Select the name of an empty transfer database
<div class="figure">
<img src="images/CalProg8.JPG" alt="Figure xxx. Transfer File Selection Menu" width="600px" height="400px" />
<p class="caption">
Figure xxx. Transfer File Selection Menu
</p>
</div>
The program prompts the user to select the calibration database containing the base period data to be exported.
<div class="figure">
<img src="images/CalProg9.JPG" alt="Figure xxx. Propmpt to select the calibration database" width="300px" height="150px" />
<p class="caption">
Figure xxx. Propmpt to select the calibration database
</p>
</div>
Select the desired base period and press <code>Transfer Selection Done</code>.
<div class="figure">
<img src="images/CalProg10.JPG" alt="Figure xxx. Base Period Selection Screen" width="400px" height="300px" />
<p class="caption">
Figure xxx. Base Period Selection Screen
</p>
</div>
The user is prompted to rename the transfer database.
<div class="figure">
<img src="images/CalProg11.JPG" alt="Figure xxx. Prompt to name the new transfer database" width="300px" height="150px" />
<p class="caption">
Figure xxx. Prompt to name the new transfer database
</p>
</div>
Enter a new filename into the name field of the file dialog screen and press <code>Save</code>.
<div class="figure">
<img src="images/CalProg12.JPG" alt="Figure xxx. File Dialog Rename and Save Screen" width="600px" height="350px" />
<p class="caption">
Figure xxx. File Dialog Rename and Save Screen
</p>
</div>
<div id="importing-base-period-data-into-fram" class="section level4">
<h4>Importing Base Period Data Into FRAM</h4>
A new base period can be imported into a FRAM Access database by selecting <code>FRAM Utilities</code> on the <code>Main Menu</code>. Next choose <code>Get Base Period Transfer</code>, select the transfer database and press <code>Open</code>. <br> This opens the following window:
<div class="figure">
<img src="images/BPTransfer.JPG" alt="Figure xxx. Base Period Import Screen" width="500px" height="300px" />
<p class="caption">
Figure xxx. Base Period Import Screen
</p>
</div>
<p>Fisheries and Time Steps are identical between the new and old base period. However, there are differences in Base Period Size Limits and Stocks. Check the boxes for “Base Period Size Limits” and “Stocks” to also import this information, then select <code>Done</code>. <br> The new base period will be added to the existing base period tables with a new (incremented by 1) base period ID. When data import is completed the “FRAM Utilities” page will reappear.<br> To ensure the import was successful, it is good practice to check whether data exists for the new BasePeriodID in the appropriate tables. The following tables include data from the base period dataset:</p>
<ul>
<li><p>AEQ</p></li>
<li><p>BaseCohort</p></li>
<li><p>BaseExploitationRate</p></li>
<li><p>EncounterRateAdjustment</p></li>
<li><p>FisheryModelStockProportion</p></li>
<li><p>Growth</p></li>
<li><p>IncidentalRate</p></li>
<li><p>MaturationRate</p></li>
<li><p>NaturalMortality</p></li>
<li><p>ShakerMortRate</p></li>
</ul>
<p>Now there are just a few additional steps needed to update the <code>StockVersion</code> and link runs to the newly imported base period.<br> Retrieve the stock version number from FRAM’s database. This number is located in the <code>Stock</code> table <code>StockVersion</code> field.<br> Next, in the Access database, open the <code>BaseID</code> table and identify the <code>BasePeriodID</code> for the record that was just added (check the <code>DateCreated</code> field for help). For this record, update the value in the <code>StockVersion</code> field to the value from the <code>Stock</code> table.<br> Open the <code>RunID</code> table. For any existing model runs stored in the database that you wish to run with the new base period data set, update the value in the <code>BasePeriodID</code> field to the new BaseID.<br></p>
</div>
</div>
<div id="code-description" class="section level3">
<h3>Code Description</h3>
</div>
<div id="instructions-for-producing-a-new-base-period-specific" class="section level3">
<h3>Instructions for Producing a New Base Period (specific)</h3>
<p>The following instructions are specific to the steps needed to produce base period 7.1.</p>
<div id="compile-and-update-data" class="section level4">
<h4>Compile and update data</h4>
<p>Update all data needed for calibration and FRAM validation databases.</p>
</div>
<div id="produce-validation-runs" class="section level4">
<h4>Produce Validation Runs</h4>
<p>Validation runs must be completed with the newest year first, going backwards consecutively, because the 2s from 3s method designates abundance values for 2 year olds for a given year based upon the abundance values of 3 year olds in year + 1.</p>
<div id="normal-running-procedures" class="section level5">
<h5>Normal Running Procedures</h5>
<ol style="list-style-type: decimal">
<li><p>Open FRAM</p></li>
<li><p>Click the green <code>Open Database</code> button. Select the desired validation run database and click <code>Open</code>. Select the desired year to run.</p></li>
<li><p>Click the green <code>Run Model</code> button. Ensure that the <code>Size Limit Fix</code> box is checked. Click the green <code>Run Model</code> button</p></li>
<li><p>Click the green <code>Post Season Run</code> button. Edit the number of iterations as you see fit (40 iterations is normally acceptable, but always double check results). Click the green <code>Start Iterations</code> button. Use TAMI Catches if this is your first set of validation runs for the data base. Otherwise, do not use TAMI catches.</p></li>
<li><p>After BKFRAM is complete (this process generally takes 1-5 minutes), complete the “BKFRAM Targets vs. Outputs” QAQC as described <a href="#QAQC">below</a>. If there were no errors during BKFRAM QAQC, continue to the next step. If there were errors, see the <a href="#errors">Errors</a> section below.</p></li>
<li><p>Click the green <code>Save Model Run Inputs</code> button and on the next screen click the green <code>Replace Current Model Run</code> button.</p></li>
<li><p>Click the green <code>Run Model</code> button. Ensure that the <code>Size Limit Fix</code> box is checked. Click the green <code>Run Model</code> button.</p></li>
<li><p>Next, we must perform the age 2s from 3s procedure. If this is the first (i.e., most recent) year in the validation runs, press the green <code>FRAM Utilities</code> button. Press the green <code>Compute 2s From 3s (Chin)</code> button. When the pop up appears, click <code>Yes</code>. On the next pop up, click the green <code>Replace Current Model Run</code> button. In the next window click the green <code>EXIT</code> button. Proceed to the next step. If the year you’re currently on is NOT the most recent year in validation runs, age 2s from 3s should be calculated using the age 3 abundances from year +1. We recommend using the supplied R code. See <a href="literature/“BY Age 2 from 3.R"> “BY Age 2 from 3.R” </a> for more information. To use the code properly, make sure the file path and name in code line 22 matches the location and name of the validation data base. Also, ensure that the year in line 19 correctly matches the year you’re on.</p></li>
<li><p>Click the green <code>Run Model</code> button. Ensure that the <code>Size Limit Fix</code> box is checked. Click the green <code>Select TAMM</code> button. Choose the TAMM associated with the year being run. Click the green <code>Run Model</code> button. When the pop up appears, click <code>Yes</code> to paste values into the TAMM.</p></li>
<li><p>After the run is complete, open the TAMM on your task bar, and navigate to the <code>ER_ESC_Overview(ifanyMSF)</code> tab. Check for ER differences with the previous run in cells AC7:AF35. If ER differences are minor (I usually aim for less than 5 thousandths of a percent in all stocks), move to the next year (year = year - 1). If they are greater than 5 thousandths of a percent, cells B7:E35 should be copied and pasted into cells AH6:AK35. Then steps 4-10 should be repeated until ER differences are less than 5 thousandths of a percent for all stocks.</p></li>
<li><p>Implement additional TAMM procedures<br></p></li>
</ol>
<ul>
<li>South Puget Sound Iterations</li>
<li>North of Ayock/South of Ayock Splits</li>
</ul>
<p>See <a href="https://framverse.github.io/fram_doc/user_main_menu_full.html#Chinook70" target="_blank">User Manual </a> for more information.</p>
</div>
<div id="new-base-period-running-procedures" class="section level5">
<h5>New Base Period Running Procedures</h5>
<p>Complete steps above, but do not check size limit box.</p>
</div>
<div id="qaqc" class="section level5">
<h5><span id="QAQC">QAQC</span></h5>
<ul>
<li>Check BKFRAM Targets vs. Outputs</li>
<li>Check 2s from 3s</li>
<li>Check TAMM ERs vs. Last Iteration</li>
</ul>
</div>
<div id="errors-encountered" class="section level5">
<h5><span id="errors">Errors Encountered</span></h5>
<p>The purpose of this section is to describe errors encountered during post-season runs, potential causes, and potential solutions. This is an incomplete list and it is possible to experience problems that differ from those described below.</p>
<p>1.) Error message while conducting a forward run with TAMM</p>
<p>TAMM values not converging<br> This situation is typically caused by a fish scalar of zero during a time with catch in the validation run database/TAMM. To identify where the issue occurs, see the FRAMcheck.txt file in the folder where the validation run database is located. By scrolling through the text file, it is possible to identify the fishery for which values do not converge. Once the fishery has been identified, ensure that the fishery flags are correct in the validation run database and that the scalar is not equal to 0 (for a fix set to 1).</p>
<p>2.) Terminal run size does not converge with the terminal run size inputs during BKFRAM</p>
<p>This is typically caused by incorrect BKFRAM flags. For the stock that does not converge, identify the stock ID in terms of its BKFRAM stock ID. This is done by taking the stock number in the 38 stock format and multiplying it by 3 (total; times 3+1 for unmarked; times 3+2 for marked). For example, Willapa is stock 37 and becomes stocks 111-113 in BKFRAM. Convergence issues can generally be fixed by changing the BKtarget flag from a 3-&gt;1 within the validation run database. If the flag is already a 1, and there are convergence issues, replace it with a 3.</p>
</div>
</div>
</div>
</div>
</div>

<footer>
      <br>
      <p style="color: #326020; font-weight: bold; text-align:right">
        Contributing partners:
        <a href="https://www.pcouncil.org/managed_fishery/salmon/" target="_blank">PFMC</a>
        <a href="https://wdfw.wa.gov/fishing" target="_blank">WDFW</a>  
        <a href="https://nwifc.org/" target="_blank">NWIFC</a>
      </p>
</footer>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>


</body>
</html>
